# 背景

IEEE754无法精准表达所有数字，java bigdecimal可以，并且它是不变的，性能较差。
出于性能考虑，如何用long来表达价格、数量、手续费等

## currency

| 币    | multiplier |
|------|:----------:|
| USDT |    1e6     |
| BTC  |    1e8     |
| SHIB |    1e0     |

java max long 9223372036854775807
不可能简单用long表示 1e4（价格、成家额） * 1e6（数量） * 1e6(手续费) 留给整数部分的不够

## binance

| 交易对  |     价格     | 价格精度 |   数量    | 数量精度 |
|------|:----------:|:----:|:-------:|:----:|
| BTC  |  41134.49  |  2   | 0.00029 |  5   |
| SHIB | 0.00000922 |  8   | 1000000 |  0   |      

## 采用思路1

### 以币的精度为准，所有涉及币的数量均乘以乘数

| ~  |   交易对    |    价格     |   数量    |      成交额      | ask taker手续费(USDT 0.2%) | ask maker手续费(USDT 0.1%) | bid settlement taker手续费(USDT 0.2%) | bid settlement maker手续费(USDT 0.1%) | bid taker手续费(BTC 0.2%) | bid maker手续费(BTC 0.1%) |
|----|:--------:|:---------:|:-------:|:-------------:|:-----------------------:|:-----------------------:|:----------------------------------:|:----------------------------------:|:----------------------:|:----------------------:|
| 原始 | BTC-USDT | 41134.49  | 0.00029 |  11.9290021   |      0.0238580042       |      0.0119290021       |            0.0238580042            |            0.0119290021            |       0.00000058       |       0.00000029       |
| 乘倍 | BTC-USDT | 411344900 |   290   |  119290.021   |       238.580042        |       119.290021        |             238.580042             |             119.290021             |          0.58          |          0.29          |
| 原始 | BTC-USDT | 41134.49  | 1.00029 | 41146.4190021 |      82.2928380042      |      41.1464190021      |           82.2928380042            |           41.1464190021            |       0.00200058       |       0.00100029       |
| 乘倍 | BTC-USDT | 411344900 | 1000290 | 411464190.021 |      822928.380042      |      411464.190021      |           822928.380042            |           411464.190021            |        2000.58         |        1000.29         |

| 价格       | 乘乘数        |   数量    | 方向  | taker side | 成本  |   支出    |   得到    | 剩余｜ |
|----------|------------|:-------:|:---:|------------|:---:|:-------:|:-------:|:---:|
| 41134.49 | 4113449000 | 0.00029 | bid | bid        | 239 | 119291  | 0.00029 |  0  |
| 41134.49 | 4113449000 | 0.00029 | ask | bid        | 120 | 0.00029 | 119171  |  0  |
| 41134.49 | 4113449000 | 0.00029 | bid | ask        | 120 | 119291  | 0.00029 | 119 |
| 41134.49 | 4113449000 | 0.00029 | ask | ask        | 239 | 0.00029 | 119052  |  0  |


| 价格       | 乘乘数           |   数量    | 方向  | taker side |      成本       |      支出       |   得到    | 剩余｜ |
|----------|---------------|:-------:|:---:|------------|:-------------:|:-------------:|:-------:|:---:|
| 41134.49 | 4113449000000 | 0.00029 | bid | bid        |  2385800.42   |  1192900210   | 0.00029 |  0  |
| 41134.49 | 4113449000000 | 1.00029 | bid | bid        | 8229283800.42 | 4114641900210 |         |  0  |

## 思路2，不采用

### 以交易对的数量、价格精度为准

| ~  |   交易对    |    价格     |   数量    |      成交额      | ask taker手续费(USDT 0.2%) | ask maker手续费(USDT 0.1%) | bid settlement taker手续费(USDT 0.2%) | bid settlement maker手续费(USDT 0.1%) | bid taker手续费(BTC 0.2%) | bid maker手续费(BTC 0.1%) |
|----|:--------:|:---------:|:-------:|:-------------:|:-----------------------:|:-----------------------:|:----------------------------------:|:----------------------------------:|:----------------------:|:----------------------:|
| 原始 | BTC-USDT | 41134.49  | 0.00029 |  11.9290021   |      0.0238580042       |      0.0119290021       |            0.0238580042            |            0.0119290021            |       0.00000058       |       0.00000029       |
| 乘倍 | BTC-USDT |  4113449  |   29    |   119290021   |       238580.042        |       119290.021        |             238580.042             |             119290.021             |          0.58          |          0.29          |
| 原始 | BTC-USDT | 41134.49  | 1.00029 | 41146.4190021 |      82.2928380042      |      41.1464190021      |           82.2928380042            |           41.1464190021            |       0.00200058       |       0.00100029       |
| 乘倍 | BTC-USDT | 411344900 | 1000290 | 411464190021  |      822928380.042      |      411464190.021      |           822928380.042            |           411464190.021            |        2000.58         |        1000.29         |


## 经验

USDT的精度必须大于等于交易对价格精度